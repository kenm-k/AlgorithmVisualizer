<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlgoViz</title>
  <link rel="stylesheet" href="./css/style.css" type="text/css">
  <link rel="icon" href="./img/algoviz_favicon.png">
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://frogcat.github.io/canvas-arrow/canvas-arrow.js"></script>
  <script src="./js/mymath.js"></script>
</head>
<body>

    <div class="app">

            <aside class="sidebar">

                <!-- <h1>Algorithm Visualizer</h1> -->
                <img src="./img/algoviz_logo.png">

                    <input type="file" accept="application/json">

                    <button onclick="resetPos();">位置を戻す</button>

                    <details>
                        <summary><b>アニメーション</b></summary>
                        <p>fps : <input type="number" id="fps" value="30" onchange="paramUpdate(); setFig(fpInterval);"></p>
                        <p style="display: none;">グラフの更新間隔(ms) : <input type="number" id="frameInterval_ms" value="1000" onchange="paramUpdate(); setFig(fpInterval);"></p>

                        <div class="lump" style="display: flex; align-items: center">
                            グラフ : <input style="width: 50%;" type="number" min="1" max="1" id="frame" onclick="paramUpdate(); resetFlag = false;"> / <span id="numberOfFrame">1</span>
                        </div>
                        <div class="lump" style="display: flex; align-items: center">
                            フレーム : <input style="width: 50%;" type="number" min="1" max="1" id="fig" onclick="paramUpdate(); resetFlag = false;"> / <span id="numberOfFig">0</span>
                        </div>
                        <div style="display: flex;">
                            <button onclick="if(resetFlag) {setFig(1); resetFlag = false;}; if (!isPlaying){ playAnim(); }else{ stopFlag = true; }" id="playButton">▶</button>
                            <button onclick="if(!isPlaying){resetGraph(); resetFlag = true;}">リセット</button>
                        </div>
                    </details>
        
                    <details>
                        <summary><b>録画</b></summary>
                        <button onclick="if (!recording) {startRecord(); this.textContent = '録画⏸';} else {stopRecord();this.textContent = '録画▶';} " id="playButton">録画▶</button>
                    </details>

                    <details>
                        <summary><b>外観</b></summary>
                        <p>キャンバスの背景色 : <input type="color" style="width: 100px; height: 50px;" onchange="canvas.style.background = this.value;" value="#c7c7c7"></p>
                    </details>

                    <div id="GManager" class="lump">
                        <div class="lump">
                            <b>オブジェクト</b>
                            <br>
                            <select id="filterMode" onchange="updateGMan();">
                                <option>AND</option>
                                <option>OR</option>
                            </select>
                            <input type="text" id="filter" placeholder="filter カンマ区切り" onchange="updateGMan();">
                        </div>
                        <div class="lump" id="selectedGObj">
                        <b>selected</b>
                        </div>
                    </div>
            </aside>

            <main class="stage">
                    <canvas id="canvas"></canvas>
            </class>

    </div>

    <script src="./js/glovalVar.js"></script>
    <script src="./js/GObjects.js"></script>
    <script src="./js/animation.js"></script>
    <script src="./js/canvas.js"></script>
    <script src="./js/file.js"></script>
    <script src="./js/graphLayout.js"></script>
    <script src="./js/drawing.js"></script>
    <script src="./js/GManager.js"></script>
    <script>
        function resizeCanvasToDisplaySize() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            const displayWidth  = Math.round(rect.width  * dpr);
            const displayHeight = Math.round(rect.height * dpr);

            if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
                canvas.width = displayWidth;
                canvas.height = displayHeight;
                // 座標系をDPRに合わせてスケール
                context.setTransform(dpr, 0, 0, dpr, 0, 0);
            }
        }

        // 初期化とリサイズ対応
        function render() {
            resizeCanvasToDisplaySize();
            draw();
        }
        window.addEventListener('resize', render);
        matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).addEventListener?.('change', render);

        render();
    </script>
</body>
</html>
